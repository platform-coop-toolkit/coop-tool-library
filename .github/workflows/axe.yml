name: Run tests

on: [push, pull_request]

jobs:
  test-axe:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v1
    - name: Cache node modules
      uses: actions/cache@v1
      with:
        path: node_modules
        key: ${{ runner.OS }}-build-${{ hashFiles('**/package-lock.json') }}
    - name: npm install and test
      run: |
        npm install
      env:
        CI: true
    - name: Waiting for 200 from the Netlify Preview
      uses: jakepartusch/wait-for-netlify-action@v1
      id: waitFor200
      with:
        site_name: "coop-tool-library"
    - name: Axe CLI
      run: |
        npm install -g axe-cli
        axe ${{ steps.waitFor200.outputs.url }}
